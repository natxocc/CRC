export default{data:()=>({lang:null,columnDefs:null,columnDefsSub:null,rowData:null,quickFilter:null,idKey:null,table:null,cmd:null,loading:!1,dialogModel:!1,dialogData:{},dialogFields:{},dialogTable:null,dialogTitle:null,notify:{model:!1,color:"",text:""}}),methods:{callData(post){let self=this;return post.sid=localStorage.sid,post.lang=this.lang.db,fetch(localStorage.url,{method:"post",body:JSON.stringify(post)}).then(response=>response.json()).then(response=>"getRecords"==post.cmd?(self.defineTable(response),response):(1==response.success?self.newMessage(self.lang.DatosGuardados,"success"):self.newMessage(self.lang.ErrorOperacion,"error"),response))},newMessage(text,color){this.notify.text=text,this.notify.color=color,this.notify.model=!0},setId(columns){let idkey=columns.find(function(x){return!0===x.groupId});this.idKey=idkey.field},defineTable(data){return data.success?(this.columnDefs=data.columns,this.rowData=data.data,this.table=data.table,data.columnsSub&&(this.columnDefsSub=data.columnsSub),!0):(this.$q.notify({message:lang.SinAutorizacion,icon:"close",color:"negative"}),!1)},defineDialog(columns,data,table){this.setId(columns);let result={data:{},fields:{}},fields=columns.map(x=>x.field);for(let i=0;i<fields.length;i++)result.fields[fields[i]]={},result.fields[fields[i]].name=columns[i].headerName,result.fields[fields[i]].type=columns[i].type,result.fields[fields[i]].options=[],""!=columns[i].headerClass&&(result.fields[fields[i]].props={},result.fields[fields[i]].props.disable=!!columns[i].headerClass.disable&&columns[i].headerClass.disable,result.fields[fields[i]].props.hidden=!!columns[i].headerClass.hidden&&columns[i].headerClass.hidden,result.fields[fields[i]].props.autofocus=!!columns[i].headerClass.autofocus&&columns[i].headerClass.autofocus,result.fields[fields[i]].props.autogrow=!!columns[i].headerClass.autogrow&&columns[i].headerClass.autogrow,(columns[i].headerClass.select||columns[i].headerClass.autocomplete)&&(result.fields[fields[i]].options=[...new Set(this.rowData.map(x=>x[fields[i]]))],result.fields[fields[i]].type=columns[i].headerClass.autocomplete?"autocomplete":"select"),columns[i].headerClass.required),result.data[fields[i]]=null,data?(this.cmd="updateRecord",this.dialogTitle=this.lang.Editar,result.data[fields[i]]=data[fields[i]]):(this.cmd="insertRecord","date"==columns[i].type&&(result.data[fields[i]]=(new Date).toISOString().substr(0,10)),"datetime"==columns[i].type&&(result.data[fields[i]]=(new Date).toISOString().slice(0,19).replace("T"," ")),"bit"==columns[i].type&&(result.data[fields[i]]=0),this.dialogTitle=this.lang.Nuevo);return this.dialogTable=this.table,table&&(this.dialogTable=table),this.dialogData=result.data,this.dialogFields=result.fields,console.log(result),!0},getDaysWeek(year,week){var dateini=new Date(year,0,1),offset=dateini.getTimezoneOffset();dateini.setDate(dateini.getDate()+4-(dateini.getDay()||7)),dateini.setTime(dateini.getTime()+6048e5*(week+(year==dateini.getFullYear()?-1:0))),dateini.setTime(dateini.getTime()+60*(dateini.getTimezoneOffset()-offset)*1e3),dateini.setDate(dateini.getDate()-3);let dateend=new Date(dateini),result;return dateend.setDate(dateini.getDate()+6),{dateini:dateini=dateini.toISOString().substr(0,10),dateend:dateend=dateend.toISOString().substr(0,10)}},getDateTime:date=>new Date(date).toISOString().slice(0,19).replace("T"," "),getWeeks(){let weeks=[];for(let i=0;i<55;i++)weeks[i]=i+1;return weeks},setLang(lang){localStorage.lang&&lang||(lang="es"),this.lang=this.$lang[lang],localStorage.lang!=lang&&(localStorage.lang=lang,location.reload())}},beforeMount(){}};